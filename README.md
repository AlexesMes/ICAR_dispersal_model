# ICAR_dispersal_model: An ICAR spatial model to reconstruct regional geographic variations in arrival times
All data and scripts required to reproduce the analysis for the paper 'An ICAR spatial model to reconstruct regional geographic variations in arrival times' are located within this repository. The repository is organised into four main directories: _src_, _scripts_, _data_, _output_.

# Bayesian Analyses
The repository contains scripts and results of an hierarchical Bayesian ICAR model used to inferred arrival times on different sets of simulated data with underlying dispersal patterns. In addition, analysis using a hierarchical Bayesian phasemodel provides a benchmark of an existing method. 
All models were defined and fitted using the [nimble](https://r-nimble.org/) R package, with the additional support of custom distributions and utility functions of the [nimbleCarbon](https://CRAN.R-project.org/package=nimbleCarbon) R package. **Please note that the analyses are computationally intensive**

# Folder Structure
* the _src_ folder contains all functions inputs required for the analysis
* the _scripts_ folder contains all the R-code scripts for running the analysis and generating the figures
* the _data_ folder contains the simulated data required to reproduce the analysis
* the _output_ folder contains all outputs generated by the scripts, including figures. MCMC posterior samples of all analyses are stored as R image files in this directory.

# Datasets
Simulated data were used to assess the robustness of the proposed ICAR model. The simulated datasets required for all analyses are contained in the directory _data_. Each dataset is generated by calling the sim_data() function from the `sim_data.R` script located in the _src_ folder.  Specifically,
* `tactical_sim_woa_noerror.RData` contains the simulated data for the Wave of Advance simulation ("Section 3.1. Wave of Advance Simulation" in the paper). Generated from the script `womble_model_tactical_uncal.R` (found in the _scripts_ folder).
* `tactical_sim_icar.RData` contains the simulated data one covariate for both the ICAR model and phasemodel analyses ("Section 3.2. Comparing the ICAR model to a Phase model" in the paper). Generated from the script `womble_model_tactical_cal.R` (found in the _scripts_ folder).

Further, in the directory _data_, there are R images:
* `trig.RData` ~ the file `triangulation.R` (also in the _scripts_ folder) generates `trig.RData` which contains node and edge information from delaunay triangulation between regional hexagonal areas.
* `sample_window.RData` ~ contains spatial information defining the sample region and local hexagon areas. Again, generated from the `triangulation.R` (found in the _scripts_ folder).


# File Relationships

| **Analysis**                                          | **Input Data**                        | **Analyses Script**                    | **R Image containing Results**                       |
|-------------------------------------------------------|---------------------------------------|----------------------------------------|------------------------------------------------------|
| Hierarchical ICAR Model (Simulated, calendar dates)   | tactical_sim_woa_noerror.RData        | womble_model_tactical_uncal.R          | Womblemodel_tactical_woa_norerrors.RData             |
| Hierarchical ICAR Model (Simulated, radiocarbon dates)| tactical_sim_icar.RData               | womble_model_tactical_cal.R            | Womblemodel_tactical_icar.RData                      |
| Hierarchical Phasemodel (Simulated, radiocarbon dates)| tactical_sim_icar.RData               | womble_model_tactical_phasemodel.R     | Womblemodel_tactical_phasemodel.RData                |
| Hierarchical ICAR Model (Simulated, calendar dates)   | Multiple simulated from sim_data()    | womble_model_tactical_icar_sitenumber.R| Womblemodel_tactical_icar_sitenumber.RData           |
| Hierarchical ICAR Model (Simulated, calendar dates)   | Multiple simulated from sim_data()    | womble_model_tactical_icar_clustering.R| Womblemodel_tactical_icar_clustering.RData           |